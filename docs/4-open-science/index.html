<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.217">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Global Health Engineering - Untitled</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Global Health Engineering</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../1-slides/index.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../2-tutorials/data-package.html" rel="" target="">
 <span class="dropdown-text">R data package - the GHE way</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../3-blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/Global-Health-Engineering/website" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#open-science-see-overview-page" id="toc-open-science-see-overview-page" class="nav-link active" data-scroll-target="#open-science-see-overview-page">Open Science (see Overview page)</a>
  <ul class="collapse">
  <li><a href="#projects" id="toc-projects" class="nav-link" data-scroll-target="#projects">Projects</a>
  <ul class="collapse">
  <li><a href="#openwashdata" id="toc-openwashdata" class="nav-link" data-scroll-target="#openwashdata">openwashdata</a></li>
  <li><a href="#openjmp" id="toc-openjmp" class="nav-link" data-scroll-target="#openjmp">openjmp</a></li>
  <li><a href="#data-stewardship-network" id="toc-data-stewardship-network" class="nav-link" data-scroll-target="#data-stewardship-network">Data Stewardship Network</a></li>
  </ul></li>
  <li><a href="#courses" id="toc-courses" class="nav-link" data-scroll-target="#courses">Courses</a>
  <ul class="collapse">
  <li><a href="#rbtl" id="toc-rbtl" class="nav-link" data-scroll-target="#rbtl">rbtl</a></li>
  <li><a href="#open-science-tools" id="toc-open-science-tools" class="nav-link" data-scroll-target="#open-science-tools">Open Science Tools</a></li>
  </ul></li>
  <li><a href="#fellowship" id="toc-fellowship" class="nav-link" data-scroll-target="#fellowship">Fellowship</a></li>
  <li><a href="#strategy-planning" id="toc-strategy-planning" class="nav-link" data-scroll-target="#strategy-planning">Strategy &amp; Planning</a></li>
  <li><a href="#data-management-strategy" id="toc-data-management-strategy" class="nav-link" data-scroll-target="#data-management-strategy">Data Management Strategy</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Untitled</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="open-science-see-overview-page" class="level1">
<h1>Open Science (see Overview page)</h1>
<p>We are committed to Open Science. It is a movement aimed at making scientific research more accessible, inclusive, and transparent. Our vision is that all our research output is reproducible. To ensure this, it is our mission to foster an Open Science culture and empower students, researchers, and staff with tools and workflows that enable open data and open code.</p>
<p>Our tactics achieve this by:</p>
<ul>
<li>holding a 3-hour Quarterly team event, which discusses and integrates elements of Open Science</li>
<li>teaching courses at ETH that build competencies in research design, research data management, scientific communication and computational tools (R, Quarto, Git, GitHub)</li>
<li>contributing to networks, communities, and working groups for Open Science and reproducibility</li>
<li>writing grant applications that target programmes focused on Open Science</li>
</ul>
<p>We have developed a data publishing workflow, which support ideas around next generation metrics. Raw, but analysis-ready data is documented and shared prior to the preparation of scientific articles. Where applicable, data from BSc and MSc projects is published. Every data publication is considered a standalone research output with its unique DOI (digital object identifier) and all contributors, including research support staff (e.g.&nbsp;enumerators, laboratory technicians) are added to publications with their unique ORCID iD.</p>
<p>The diagram below highlights the elements and tools of our workflow:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="img/ghe-rdm-workflow.svg" class="img-fluid"></p>
</div>
</div>
<p><strong>Communciation</strong></p>
<p>Within in our group we avoid Email by all means. For management and communication on tasks, we use the GitHub issue tracker and Asana task management tool. For instant communication, we use the Matrix chat protocol in combination with Element. For anyone that is interested to connect with us on Open Science, we provide an open room on Element that can be accessed and joined at: https://matrix.to/#/#ghe-open:staffchat.ethz.ch</p>
<section id="projects" class="level2">
<h2 class="anchored" data-anchor-id="projects">Projects</h2>
<section id="openwashdata" class="level3">
<h3 class="anchored" data-anchor-id="openwashdata">openwashdata</h3>
<p>Add Mian’s content.</p>
</section>
<section id="openjmp" class="level3">
<h3 class="anchored" data-anchor-id="openjmp">openjmp</h3>
<p>Open JMP - unlocking the potential of global indicator data</p>
<ul>
<li>Project start: 2023-01-05</li>
<li>Project duration: 12 months</li>
<li>Project lead: Global Health Engineering</li>
<li>Funding: Open Research Data Program of the ETH Board</li>
<li>Funding: 30,000 CHF</li>
</ul>
<p>Decades of manual data structuring have resulted in the most comprehensive and internationally-comparable information on Water, Sanitation, and Hygiene (WASH) coverage. The databases are maintained by the WHO/UNICEF Joint Monitoring Programme for Water Supply, Sanitation and Hygiene (JMP) and data are shared in spreadhsheet-based proprietary software. This under utilizes the potential those data could have for other purposes than the national, regional and global monitoring of progress in WASH mandated to the JMP.</p>
<p>The project has three Work Packages, which can be summarised as follows.</p>
<p>I have analyzed the attached project proposal in Markdown format[1]. Here is a concise three-bullet summary of each work package:</p>
<section id="wp1-document-and-publish-r-data-package-jmpinput" class="level4">
<h4 class="anchored" data-anchor-id="wp1-document-and-publish-r-data-package-jmpinput">WP1: Document and publish R data package <code>jmpinput</code></h4>
<ul>
<li>Goal: Make JMP input data readily accessible for researchers and practitioners.</li>
<li>Main output: An R data package with detailed documentation, metadata, codebooks, and a public website.</li>
<li>Activities: Write documentation, prepare use cases as vignettes, publish data and documentation as an R package, and create a public website.</li>
</ul>
</section>
<section id="wp2-prepare-and-document-r-software-package-jmpmodel" class="level4">
<h4 class="anchored" data-anchor-id="wp2-prepare-and-document-r-software-package-jmpmodel">WP2: Prepare and document R software Package <code>jmpmodel</code></h4>
<ul>
<li>Goal: Develop open-source software for transparent documentation of modeling activities for primary indicators.</li>
<li>Main output: An R software package with complete documentation and a public website.</li>
<li>Activities: Collaborate with JMP team to replicate production of basic indicators, prepare R functions for data manipulation, modeling, and visualization, write documentation, and publish R functions as a software package.</li>
</ul>
</section>
<section id="wp3-dissemination" class="level4">
<h4 class="anchored" data-anchor-id="wp3-dissemination">WP3: Dissemination</h4>
<ul>
<li>Goal: Seek active collaboration on package development to increase potential usage and long-term maintenance of data and software package.</li>
<li>Main output: Increased community engagement and dissemination of developed products.</li>
<li>Activities: Continuously update JMP team on progress, host two public participatory live coding online workshops to showcase developed R packages from WP1 and WP2.</li>
</ul>
<p>Read the full funded proposal, including Project Plan and Work Packages here: https://github.com/openwashdata/proposal-eth-ord-scheme-contribute/blob/main/proposal-eth-ord-scheme-contribute.md</p>
</section>
</section>
<section id="data-stewardship-network" class="level3">
<h3 class="anchored" data-anchor-id="data-stewardship-network">Data Stewardship Network</h3>
</section>
</section>
<section id="courses" class="level2">
<h2 class="anchored" data-anchor-id="courses">Courses</h2>
<section id="rbtl" class="level3">
<h3 class="anchored" data-anchor-id="rbtl">rbtl</h3>
<p>Research Beyond the Lab: Open Science and Research Methods for a Global Engineer</p>
<p>Offered for the first time in 2022, we will teach a revised version of this course in spring 2024. We designed this course to teach learners how to conduct a research project out of the lab, and apply Open Science principles to their data analysis projects.</p>
<p>Over the course of the semester, students will develop a research project and learn the necessary quantitative methods required to collect data from people. We will use tidyverse R packages to work with data, git and GitHub as tools for version control and collaboration, and Quarto publishing system for scientific writing. By the end of the course, students will have a complete overview of how a typical research project is designed, implemented, analysed, and communicated.</p>
<p>All materials are published as <a href="https://github.com/rbtl-fs22">Open Educational Resources with permissve licenses through GitHub</a>. For students, these course materials are available as a public website: https://rbtl-fs22.github.io/website/.</p>
</section>
<section id="open-science-tools" class="level3">
<h3 class="anchored" data-anchor-id="open-science-tools">Open Science Tools</h3>
<p>Open Science Tools - authoring and publishing workflows for collaborative scientific writing</p>
<p>This course offers researchers a hands-on opportunity to learn open source tools and platforms that are accessible beyond institutional employment. The participatory live coding teaching technique involves an instructor writing and narrating code as they teach, and inviting learners to write and execute the same code.</p>
<p>Topics covered include:</p>
<ul>
<li>Scientific communication.</li>
<li>Reproducible research (open research, version control, licensing).</li>
<li>Collaboration through Git and GitHub.</li>
</ul>
<p>During the course, participants will learn how to use the Quarto file format to prepare various scholarly documents, including slides, scientific articles, books, and websites. Additionally, we will demonstrate how GitHub can serve as both a project management tool and a publishing platform using GitHub Pages.</p>
<p>While the course will introduce commonly used tools in software development, they will not be explained in great detail. Instead, the goal is to expose learners to the tools and concepts, requiring openness to new ideas.</p>
<p>Course Catalogue: https://www.vorlesungen.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?lerneinheitId=174400&amp;semkez=2023W&amp;ansicht=LEHRVERANSTALTUNGEN&amp;lang=en Website: https://ost-hs23.github.io/website/ GitHub organisation: https://github.com/ost-hs23/</p>
</section>
</section>
<section id="fellowship" class="level2">
<h2 class="anchored" data-anchor-id="fellowship">Fellowship</h2>
<p>In 2022, we started offering an Open Science fellowship. The goal of the fellowship is to support students in applying Open Science principles to their research. Students are invited to join our group at ETH for a duration of five months between July and October. The fellowship is offered as part of the<a href="https://ethz.ch/en/studies/non-degree-courses/project.html">ETH project mobility students programme</a>.</p>
<p>The conditions for application are:</p>
<ul>
<li>student from a university in Africa</li>
<li>enrolled in MSc. programme</li>
<li>data for thesis has already been collected</li>
</ul>
<p>We support the fellowship with 20’000 CHF which covers:</p>
<ul>
<li>flights</li>
<li>accomodation in Zurich</li>
<li>a monthly stipend of 1750 CHF</li>
<li>administrative costs (first monthly ZVV pass, registration)</li>
</ul>
<p>Conditions for application are:</p>
<ul>
<li>A max 400 word summary covering MSc. thesis objectives, collected data formats, and experience using computational tools (R, Git, GitHub)</li>
</ul>
</section>
<section id="strategy-planning" class="level2">
<h2 class="anchored" data-anchor-id="strategy-planning">Strategy &amp; Planning</h2>
<p>Developing an Open Science culture within a research group requires addressing and dispelling common misconceptions about Open Science. It also requires opportunities for learning tools and methods to apply Open Science principles. We have incorporated three regular events into our research group’s organizational structure and culture:</p>
<ol type="1">
<li><p>Weekly 1-hour event: Weekly event with a shared Google Doc as a notebook. Prior to the event, everyone adds their notes to the Google Doc in four categoires (Doing this week, Done last week, Support needed, Other announcements). This events purpose is to keep everyone in the group aligned updated, but also an opportunity to discuss Open Science elements of individual projects.</p></li>
<li><p>Quarterly 4-hour event: Our Quarterly event allows for work and sharing of group-wide projects. We also invite external speakesr to help us learn more about working together efficiently. Every event has at least one element that addresses Open Science principles.</p></li>
<li><p>Yearly 2-day event: We organize an annual 2-day retreat where the research group comes together for an extended period to discuss their work, share best practices, and develop strategies for incorporating Open Science principles into our research.</p></li>
</ol>
<p>When fostering an Open Science culture, we are confronted with misconceptions around publishing data and code openly with permissive licenses. Some common misconceptions we are tackling in our strategic meetings are:</p>
<p><strong>Misconception 1: Publishing my data does not benefit anyone</strong></p>
<p>Counterargument: Publishing research data can benefit both the researcher and the scientific community. Sharing data increases the visibility of the research, potentially leading to more citations and recognition for the researcher. It promotes collaboration and enables other researchers to build upon the existing work, fostering innovation and scientific progress while avoiding ineffiencies.</p>
<p><strong>Misconception 2: Others may criticize my code</strong></p>
<p>Counterargument: While it is true that open-source code may be subject to criticism, this can be a positive aspect of Open Science. Constructive criticism can help identify potential issues, improve the code, and contribute to the overall quality of the project.</p>
<p><strong>Misconception 3: Publishing my content under CC-BY-NC will prevent people from exploiting my content commercially.</strong></p>
<p>Counterargument: While the CC-BY-NC (Creative Commons Attribution-NonCommercial) license does restrict commercial use of the content, it may also inadvertently limit the potential impact and reach of your work.</p>
<p>By using a CC-BY-NC license, you prevent the following use cases:</p>
<ul>
<li><p>Commercial use in academic research: Researchers working in collaboration with commercial entities or receiving funding from commercial sources may be unable to use your content, limiting the potential for interdisciplinary research and collaboration.</p></li>
<li><p>Commercial use in educational materials: Publishers of textbooks, online courses, and other educational materials that are sold for profit may be unable to include your content, reducing its potential reach and impact on students and educators.</p></li>
<li><p>Commercial use in software development: Companies developing software or applications that incorporate your content may be unable to do so under a CC-BY-NC license, limiting the potential for innovation and the development of new tools and technologies.</p></li>
<li><p>Commercial use in creative works: Artists, writers, and other creators who wish to incorporate your content into their commercial works may be unable to do so, limiting the potential for your work to inspire and influence others.</p></li>
</ul>
</section>
<section id="data-management-strategy" class="level2">
<h2 class="anchored" data-anchor-id="data-management-strategy">Data Management Strategy</h2>
<p>We are actively working on a coherent Data Management Strategy for our group. At this poing, we prepared a strategy for BSc and MSc projects. This so-called <a href="https://unlimited.ethz.ch/display/ghestudents/GHE+students+Wiki">GHE students Wiki is publicly available</a> and published using the Atlassian Confluence tool, for which ETH covers a license agreement.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>